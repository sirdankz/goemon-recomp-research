<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Door Transition System | Goemon Recomp Research</title>
  <link rel="stylesheet" href="./assets/style.css"/>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">
      <div class="badge"><span class="dot"></span> UPDATED notes</div>
      <div>
        <h1>Door Transition System</h1>
        <div class="subtitle">Transition flags, overlay triggers, chain</div>
      </div>
    </div>
  </div>
</header>

<div class="wrap">
  <main>
    <nav>
      <div class="navhead">
        <input id="navSearch" placeholder="Filter pages…" />
      </div>
      <ul>
        <li><a href="index.html" data-title="Home">Home</a></li>
        <li><a href="systems_overview.html" data-title="Systems Overview">Systems Overview</a></li>
        <li><a href="door_transition_system.html" data-title="Door Transition System">Door Transition System</a></li>
        <li><a href="action6_system.html" data-title="Action6 System">Action6 System</a></li>
        <li><a href="scheduler_coroutines.html" data-title="Scheduler & Coroutines">Scheduler & Coroutines</a></li>
        <li><a href="workflows_rules.html" data-title="Workflows & Rules">Workflows & Rules</a></li>
        <li><a href="tooling_gotchas.html" data-title="Tooling Gotchas">Tooling Gotchas</a></li>
        <li><a href="scripts.html" data-title="Scripts">Scripts</a></li>
        <li><a href="evidence_pack_format.html" data-title="Evidence Pack Format">Evidence Pack Format</a></li>
        <li><a href="glossary.html" data-title="Glossary">Glossary</a></li>
      </ul>
    </nav>

    <article>
      <div class="content">
        
<h2>Door Transition System</h2>
<p class="meta">Verified end-to-end proof strategy: <i>obj+0xDA consumer → field77 writer → door gate → door enter chain</i>.</p>

<h3>Key bytes</h3>
<ul>
  <li><b>Transition request</b>: <code>g_system.field77</code> @ <code>+0x3AE29</code> (written with <code>0x80</code>)</li>
  <li><b>Transition state</b>: <code>g_system.field444</code> @ <code>+0x3B01D</code></li>
</ul>

<h3>Writers / gates</h3>
<ul>
  <li>Writers of request (<code>0x80</code>): <code>FUN_80006140</code>, <code>FUN_800061B0</code>, <code>FUN_80037284</code></li>
  <li>Gate: <code>FUN_801F7B0C</code> checks <code>field77 & 0x80</code> then branches to <code>FUN_801F7C14</code></li>
  <li>Key state writer: <code>FUN_801F7F78</code> sets transition state = <code>4</code></li>
</ul>

<h3>Main chain & door-enter subchain</h3>
<pre>main scheduled chain:
801F71D0 → 728C → 750C → 75C0 → 7690 → 770C → 77F4 → 7AA4 → 7B0C → 8428

door-enter subchain:
7C14 → 7E1C → 7F78 → 8290 → 82FC → back to 7690</pre>

<h3>Overlay door trigger pipeline</h3>
<ul>
  <li>Producers (write <code>obj+0xDA</code>): <code>FUN_801FB1C0</code> (param1==0x10 gate), <code>FUN_8021D724</code>, <code>FUN_802239B0</code></li>
  <li>Consumer: <code>FUN_803BC020</code>:
    <ul>
      <li>if <code>obj+0xDA != 0</code>: sets <code>obj+0xEC |= 4</code>, clears <code>obj+0xDA</code></li>
      <li>schedules coroutines: <code>FUN_8003521C</code> with A0 targets <code>0x80001240</code> (twice) and <code>0x80001020</code> (once)</li>
    </ul>
  </li>
</ul>

<div class="callout">
<b>Why we care:</b> this is a clean “system boundary” where mods can hook a single point (consumer, gate, state writer)
and reliably affect transitions without chasing dozens of stage-specific call sites.
</div>

        <footer>Last updated: 2025-12-29. Repo: <a href="../">goemon-recomp-research</a></footer>
      </div>
    </article>
  </main>
</div>

<script src="./assets/app.js"></script>
</body>
</html>
